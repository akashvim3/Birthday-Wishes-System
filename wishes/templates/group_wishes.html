{% extends 'base.html' %}

{% block title %}Group Wishes - Birthday Wishes System{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl shadow-xl p-8 mb-8 text-white">
        <h1 class="text-4xl font-bold mb-4">
            <i class="fas fa-users mr-2"></i>
            Group Birthday Wishes
        </h1>
        <p class="text-purple-100 text-lg">
            Collaborate with friends and family to create memorable group birthday wishes
        </p>
    </div>

    <!-- Create New Group Wish -->
    <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
            <i class="fas fa-plus-circle text-purple-600 mr-2"></i>
            Create New Group Wish
        </h2>

        <form method="post" class="space-y-6">
            {% csrf_token %}

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Title *
                    </label>
                    {{ form.title }}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Recipient *
                    </label>
                    {{ form.recipient }}
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Description
                </label>
                {{ form.description }}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Contribution Deadline *
                    </label>
                    {{ form.deadline }}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Scheduled Send Date *
                    </label>
                    {{ form.scheduled_send_date }}
                </div>
            </div>

            <div class="flex items-center space-x-2">
                {{ form.allow_anonymous_contributions }}
                <label class="text-sm text-gray-700">Allow anonymous contributions</label>
            </div>

            <button type="submit"
                    class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition duration-300 font-semibold">
                <i class="fas fa-plus-circle mr-2"></i> Create Group Wish
            </button>
        </form>
    </div>

    <!-- Join Group Wish -->
    <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">
            <i class="fas fa-ticket-alt text-purple-600 mr-2"></i>
            Join Group Wish with Code
        </h2>

        <form method="post" action="{% url 'join_group_wish' %}" class="flex space-x-4">
            {% csrf_token %}
            <input type="text" name="invitation_code" required
                   placeholder="Enter invitation code (e.g., ABC123XYZ456)"
                   class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">

            <button type="submit"
                    class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition duration-300 font-semibold">
                <i class="fas fa-sign-in-alt mr-2"></i> Join
            </button>
        </form>
    </div>

    <!-- Your Group Wishes -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Created Group Wishes -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-crown text-purple-600 mr-2"></i>
                Your Created Group Wishes
            </h2>

            {% if created_wishes %}
                <div class="space-y-4">
                    {% for wish in created_wishes %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition duration-300">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="font-bold text-lg text-gray-800">{{ wish.title }}</h3>
                                <p class="text-sm text-gray-600">For: {{ wish.recipient.get_full_name|default:wish.recipient.username }}</p>
                            </div>
                            <span class="{% if wish.is_active %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %} text-xs px-3 py-1 rounded-full">
                                {% if wish.is_active %}Active{% else %}Closed{% endif %}
                            </span>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-3 mb-3">
                            <p class="text-xs text-gray-600 mb-1">Invitation Code:</p>
                            <div class="flex items-center justify-between">
                                <code class="text-sm font-mono font-bold text-purple-600">{{ wish.invitation_code }}</code>
                                <button onclick="copyCode('{{ wish.invitation_code }}')"
                                        class="text-purple-600 hover:text-purple-700">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div class="flex items-center justify-between text-sm text-gray-600 mb-3">
                            <span><i class="fas fa-users mr-1"></i> {{ wish.contributors.count }} contributors</span>
                            <span><i class="fas fa-clock mr-1"></i> Deadline: {{ wish.deadline|date:"M d" }}</span>
                        </div>

                        <a href="{% url 'group_wish_detail' wish.pk %}"
                           class="block text-center bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-300 font-semibold">
                            <i class="fas fa-eye mr-2"></i> View Details
                        </a>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-3"></i>
                    <p>You haven't created any group wishes yet.</p>
                </div>
            {% endif %}
        </div>

        <!-- Contributing Group Wishes -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                <i class="fas fa-hand-holding-heart text-purple-600 mr-2"></i>
                Group Wishes You're Contributing To
            </h2>

            {% if contributed_wishes %}
                <div class="space-y-4">
                    {% for wish in contributed_wishes %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition duration-300">
                        <h3 class="font-bold text-lg text-gray-800 mb-2">{{ wish.title }}</h3>
                        <p class="text-sm text-gray-600 mb-3">
                            For: {{ wish.recipient.get_full_name|default:wish.recipient.username }}
                        </p>

                        <div class="flex items-center justify-between text-sm text-gray-600 mb-3">
                            <span><i class="fas fa-users mr-1"></i> {{ wish.contributors.count }} contributors</span>
                            <span><i class="fas fa-calendar mr-1"></i> {{ wish.scheduled_send_date|date:"M d, Y" }}</span>
                        </div>

                        <a href="{% url 'group_wish_detail' wish.pk %}"
                           class="block text-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300 font-semibold">
                            <i class="fas fa-comment-medical mr-2"></i> Add Contribution
                        </a>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-3"></i>
                    <p>You're not contributing to any group wishes yet.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function copyCode(code) {
    navigator.clipboard.writeText(code).then(function() {
        alert('Invitation code copied to clipboard: ' + code);
    }, function(err) {
        console.error('Could not copy text: ', err);
    });
}
</script>
{% endblock %}
